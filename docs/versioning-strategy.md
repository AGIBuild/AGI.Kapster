# AGI.Captor ç‰ˆæœ¬ç­–ç•¥ï¼ˆé”å®šæ—¶é—´åºåˆ—ç‰ˆæœ¬ä½“ç³»ï¼‰

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®å·²ä»åŸºäº GitVersion çš„åŠ¨æ€è¯­ä¹‰åŒ–å¢é‡æ¨¡å¼è¿ç§»ä¸º **â€œæ—¶é—´åºåˆ—ï¼ˆTime-basedï¼‰+ æ˜¾å¼é”å®šï¼ˆLockedï¼‰+ æ ‡ç­¾é©±åŠ¨ï¼ˆTag-drivenï¼‰â€** çš„ç¡®å®šæ€§ç‰ˆæœ¬æ¨¡å‹ï¼š

| ç›®æ ‡ | æ—§æ–¹æ¡ˆ (GitVersion) | æ–°æ–¹æ¡ˆ (Locked Time-based) |
|------|---------------------|----------------------------|
| ç‰ˆæœ¬ç”Ÿæˆ | è¿è¡Œæ—¶è®¡ç®— | ä¸€æ¬¡ç”Ÿæˆï¼ŒæŒä¹…å­˜æ¡£ |
| å•ä¸€æ¥æº | éšå¼(åˆ†æ”¯+æäº¤) | `version.json` æ–‡ä»¶ |
| å¯é‡å¤æ€§ | ä¾èµ–å†å²/å·¥å…·ç‰ˆæœ¬ | çº¯æ–‡ä»¶ï¼Œå¯å®¡è®¡ diff |
| å¹¶è¡Œå†²çª | å¯èƒ½ç«æ€ | æ—¶é—´æˆ³é€’å¢è‡ªç„¶è§„é¿ |
| Changelog | å†³å®šç‰ˆæœ¬å¢é‡ | ä»…ç”¨äºåˆ†ç±»å±•ç¤º |
| è¯­ä¹‰å«ä¹‰ | SemVer è¯­ä¹‰ç­‰çº§ | äº¤ä»˜æ—¶é—´åºåˆ—ä¼˜å…ˆ |

> ç‰ˆæœ¬ä¸å†â€œè¢«è®¡ç®—â€ï¼Œè€Œæ˜¯â€œè¢«å£°æ˜å¹¶é”å®šâ€ã€‚æµæ°´çº¿åªæ¥å—ä¸ `version.json` ä¸€è‡´çš„æ ‡ç­¾ã€‚

## ğŸ”§ ç‰ˆæœ¬æ–‡ä»¶ `version.json`

ç¤ºä¾‹ï¼š
```json
{
  "version": "2025.121.915304",
  "assemblyVersion": "2025.121.915304",
  "fileVersion": "2025.121.915304",
  "informationalVersion": "2025.121.915304"
}
```

è§„åˆ™ï¼š
1. å››ä¸ªå­—æ®µå¿…é¡»å®Œå…¨ä¸€è‡´ã€‚
2. ä½œä¸º**å”¯ä¸€å¯ä¿¡æº (SSOT)**ï¼Œç¦æ­¢åœ¨ `.csproj` æ‰‹åŠ¨è¦†å†™ã€‚
3. PR å®ˆå«ä¼šæ ¡éªŒï¼šå·²é”å®šã€æ ¼å¼åˆæ³•ã€æœªè¢«éšæ„æ”¹å†™ã€‚
4. å‘å¸ƒæ ‡ç­¾åå¿…é¡»ä¸ºï¼š`v<version>`ã€‚
5. ä»»ä½•åå·® â†’ CI ç«‹å³å¤±è´¥ã€‚

æ ¼å¼æ­£åˆ™ï¼š
```
^[0-9]{4}\.[1-9][0-9]{2,3}\.[0-9]{1,2}[0-9]{4}$
```

ç»“æ„åˆ†æ®µï¼š
```
YYYY . MDD . Hmmss
â”‚      â”‚     â””â”€ Hour + mmss  (æ— åˆ†éš”ï¼Œå…¼å®¹æ–‡ä»¶/è·¯å¾„)
â”‚      â””â”€ æœˆæ—¥ï¼ˆå»å‰å¯¼0æ‹¼æ¥ï¼Œä¾‹å¦‚ Jan 21 -> 121ï¼‰
â””â”€ å…¬å†å¹´ä»½
```

### ç‰ˆæœ¬ç”Ÿæˆé€»è¾‘ï¼ˆNuke ç›®æ ‡ `UpgradeVersion`ï¼‰
1. è·å–å½“å‰ UTC æ—¶é—´ã€‚
2. æŒ‰æ ¼å¼ç”Ÿæˆå€™é€‰ç‰ˆæœ¬ï¼›è‹¥ä¸ä¸Šæ¬¡ç›¸åŒç§’ï¼Œåšè¡¥å¿é€’å¢ã€‚
3. å›å†™ `version.json` å››ä¸ªå­—æ®µã€‚
4. ä½¿ç”¨ `--lock` æ ‡è®°é”å®šï¼ˆå†…éƒ¨è®°å½•é˜²æ­¢æœªæˆæƒæ”¹å†™ï¼‰ã€‚
5. æäº¤è¯¥æ–‡ä»¶ï¼›å¦åˆ™ PR ä¸å‘å¸ƒæ£€æŸ¥ä¼šå¤±è´¥ã€‚

## ğŸŒ¿ åˆ†æ”¯ç­–ç•¥ï¼ˆç²¾ç®€åŒ–ï¼‰

| æ“ä½œ | è¦æ±‚ |
|------|------|
| é”å®šæ–°ç‰ˆæœ¬ | åœ¨ `release` åˆ†æ”¯æ‰§è¡Œ `UpgradeVersion --lock` å¹¶æäº¤ |
| åˆ›å»ºå‘å¸ƒæ ‡ç­¾ | ä»…å¯åœ¨ `release` åˆ†æ”¯ç¥–å…ˆ commit ä¸Šæ‰“ `v<version>` æ ‡ç­¾ |
| åŠŸèƒ½å¼€å‘ | `feature/*` åˆ†æ”¯å¼€å‘ï¼Œåˆå¹¶åå†é”å®šç‰ˆæœ¬ |
| ä¿®å¤è¡¥ä¸ | ä¿®å¤åˆå¹¶åé‡æ–°ç”Ÿæˆæ–°æ—¶é—´åŸºç‰ˆæœ¬ |

> ç‰ˆæœ¬å«ä¹‰ä¸åŠŸèƒ½è§„æ¨¡è§£è€¦ï¼šæ›´å¿«å‘å¸ƒã€é¿å…è¯­ä¹‰ä¸»è§‚åˆ¤æ–­å»¶è¿Ÿã€‚

ï¼ˆæ—§çš„åŸºäºåˆ†æ”¯+å¢é‡ç¤ºæ„å·²åºŸå¼ƒï¼‰

## ğŸ·ï¸ ç‰ˆæœ¬å·æ ¼å¼ï¼ˆTime-basedï¼‰

```
YYYY.MDD.Hmmss
```

ç¤ºä¾‹ï¼š`2025.121.915304`

ä¼˜åŠ¿ï¼š
- çº¿æ€§æ—¶åºå³å¯åˆ¤å®šæ–°æ—§
- ä¸éœ€è®¨è®ºâ€œæ˜¯å¦è¯¥ minor/majorâ€
- è§£æç®€å•ï¼Œæ—¥å¿—ä¸æ„ä»¶å‘½åç›´æ¥å…³è”

ä¸åŒ…å«ï¼šé¢„å‘å¸ƒ / build metadata / hotfix åç¼€â€”â€”é¢å¤–çŠ¶æ€é€šè¿‡ Release Notes æè¿°ã€‚

## ğŸ“ Conventional Commitsï¼ˆä»…ç”¨äºåˆ†ç±»å±•ç¤ºï¼‰

```bash
# åŠŸèƒ½å¢åŠ  â†’ Minor ç‰ˆæœ¬å¢é‡
feat(ui): add new dashboard layout
# 1.2.3 â†’ 1.3.0

# é—®é¢˜ä¿®å¤ â†’ Patch ç‰ˆæœ¬å¢é‡  
fix(auth): resolve login timeout issue
# 1.2.3 â†’ 1.2.4

# ç ´åæ€§å˜æ›´ â†’ Major ç‰ˆæœ¬å¢é‡
feat(api)!: redesign REST endpoints
# æˆ–åœ¨æäº¤æ­£æ–‡ä¸­åŒ…å« "BREAKING CHANGE:"
# 1.2.3 â†’ 2.0.0
```

### ä¸å†ä½¿ç”¨çš„æ ‡è®°
`+semver:major|minor|patch|breaking|skip|none` å…¨éƒ¨å¤±æ•ˆï¼Œå¯å»é™¤ã€‚

### åˆ†ç±»å¼•ç”¨ç¤ºä¾‹ï¼ˆä¾› changelog æŠ“å–ï¼‰
```
feat: æ–°å¢ GPU overlay pipeline
fix: ä¿®å¤çª—å£é—ªçƒ
refactor: æŠ½è±¡æ¸²æŸ“è°ƒåº¦å™¨æ¥å£
perf: é™ä½å†…å­˜å ç”¨ 12%
docs: æ›´æ–° release æµç¨‹
build: åˆå¹¶çŸ©é˜µå¹¶å¢åŠ  SHA256 æ¸…å•
```

## ğŸ”§ å¸¸ç”¨å‘½ä»¤ï¼ˆæ–°ç‰ˆï¼‰

```powershell
# ç”Ÿæˆå¹¶é”å®šæ–°ç‰ˆæœ¬ï¼ˆå†™å…¥ version.jsonï¼‰
./build.ps1 UpgradeVersion --lock

# éªŒè¯ç‰ˆæœ¬å·²é”å®š
./build.ps1 CheckVersionLocked

# æ˜¾ç¤ºæ„å»ºä¿¡æ¯ï¼ˆå«å½“å‰é”å®šç‰ˆæœ¬ï¼‰
./build.ps1 Info

# åˆ›å»ºå®‰è£…åŒ…ï¼ˆç¤ºä¾‹ï¼‰
./build.ps1 Package --rids win-x64,linux-x64
```

### æ„å»ºç³»ç»Ÿå‘½ä»¤

```powershell
# è·å–æ„å»ºä¿¡æ¯ï¼ˆåŒ…å«ç‰ˆæœ¬ï¼‰
./build.ps1 Info

# æ¸…ç†æ„å»ºè¾“å‡º
./build.ps1 Clean

# æ„å»ºé¡¹ç›®
./build.ps1 Build

# è¿è¡Œæµ‹è¯•
./build.ps1 Test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
./build.ps1 Test --coverage

# å‘å¸ƒåº”ç”¨ï¼ˆæŒ‡å®šå¹³å°ï¼‰
./build.ps1 Publish --rids win-x64,linux-x64,osx-x64

# åˆ›å»ºå®‰è£…åŒ…
./build.ps1 Package

# å®Œæ•´çš„CIæ„å»ºæµç¨‹
./build.ps1 Clean Build Test Publish Package
```

### Git æ ‡ç­¾ä¸å‘å¸ƒ

```bash
git tag v2025.121.915304
git push origin v2025.121.915304

# æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾
git tag -l

# åˆ é™¤æ ‡ç­¾ï¼ˆå¦‚æœéœ€è¦ï¼‰
git tag -d v1.4.0
git push origin :refs/tags/v1.4.0
```

**å‘å¸ƒç­–ç•¥è¯´æ˜**:
- ä»…å…è®¸ â€œé”å®šç‰ˆæœ¬ + åŒ¹é…æ ‡ç­¾â€ å‘å¸ƒè·¯å¾„ã€‚
- ä»»ä½•ä¸ `version.json` ä¸ä¸€è‡´çš„æ ‡ç­¾ä¼šåœ¨ `release.yml` å¤±è´¥ã€‚

## ğŸš€ CI/CD å·¥ä½œæµç¨‹ï¼ˆé«˜å±‚ï¼‰

### å¼€å‘æµç¨‹
1. åŠŸèƒ½ / ä¿®å¤åˆ†æ”¯ â†’ åˆå¹¶å…¥ `release`
2. CI éªŒè¯ï¼ˆæµ‹è¯• / è´¨é‡ / è¦†ç›–ç‡ï¼‰
3. éœ€è¦å‘å¸ƒæ—¶æ‰§è¡Œï¼š`UpgradeVersion --lock` â†’ æäº¤

### å‘å¸ƒæµç¨‹
1. åˆ›å»ºå¹¶æ¨é€ `v<locked-version>` æ ‡ç­¾
2. `release.yml`ï¼šç¥–å…ˆæ ¡éªŒ + å¹¶å‘äº’æ–¥ + ç‰ˆæœ¬åŒ¹é…
3. çŸ©é˜µæ‰“åŒ…ï¼ˆæ‰€æœ‰ RIDï¼‰â†’ éªŒè¯ç¼ºå¤±å³ fail-fast
4. ç”Ÿæˆåˆ†ç±» changelog + `SHASUMS-<ver>.txt`
5. åˆ›å»º GitHub Releaseï¼ˆç¦ç”¨è‡ªåŠ¨ notesï¼Œä½¿ç”¨è‡ªç”Ÿæˆ bodyï¼‰

è¯¦è§ï¼š [Release Workflow Guide](./release-workflow.md)

## ğŸ“Š ç‰ˆæœ¬ä¿¡æ¯è·å–

### PowerShell è„šæœ¬ç¤ºä¾‹

```powershell
function Get-LockedVersion {
  ($json = Get-Content version.json | ConvertFrom-Json) | Out-Null
  Write-Host "Locked Version: $($json.version)"
  return $json.version
}
Get-LockedVersion | Out-Null
```

### åœ¨ä»£ç ä¸­è·å–ç‰ˆæœ¬

```csharp
// åœ¨ .NET åº”ç”¨ä¸­è·å–ç‰ˆæœ¬ä¿¡æ¯
using System.Reflection;

// è·å–ç¨‹åºé›†ç‰ˆæœ¬
var assembly = Assembly.GetExecutingAssembly();
var version = assembly.GetName().Version;
var informationalVersion = assembly
    .GetCustomAttribute<AssemblyInformationalVersionAttribute>()
    ?.InformationalVersion;

Console.WriteLine($"Version: {version}");
Console.WriteLine($"Informational: {informationalVersion}");
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### 1. ç‰ˆæœ¬æœªé”å®š
æ‰§è¡Œï¼š`./build.ps1 UpgradeVersion --lock` å¹¶æäº¤ã€‚

#### 2. æ ‡ç­¾ä¸åŒ¹é…
åˆ é™¤é”™è¯¯æ ‡ç­¾ï¼š
```bash
git tag -d v2025.121.915304
git push origin :refs/tags/v2025.121.915304
```
ç¡®ä¿ `version.json` æ­£ç¡®åé‡æ–°åˆ›å»ºã€‚

#### 3. ç¥–å…ˆæ ¡éªŒå¤±è´¥
æ ‡ç­¾æŒ‡å‘ commit ä¸åœ¨ `release` åˆ†æ”¯å†… â†’ åœ¨æ­£ç¡®åŸºå‡†é‡æ–°æ‰“æ ‡ç­¾ã€‚

#### 4. ç¼ºå¤±æŸå¹³å°äº§ç‰©
çŸ©é˜µæŸ Job å¤±è´¥ â†’ ä¿®å¤åéœ€åˆ é™¤æ—§æ ‡ç­¾é‡æ–°åˆ›å»ºã€‚

### è°ƒè¯•å·¥å…·

#### æœ¬åœ°ç‰ˆæœ¬éªŒè¯
```bash
# å®Œæ•´ç‰ˆæœ¬ä¿¡æ¯
dotnet gitversion

# JSON æ ¼å¼è¾“å‡º
dotnet gitversion /output json

# ç‰¹å®šä¿¡æ¯æŸ¥è¯¢
dotnet gitversion /showvariable SemVer
dotnet gitversion /showvariable FullSemVer
dotnet gitversion /showvariable BranchName
dotnet gitversion /showvariable CommitsSinceVersionSource
```

#### æ„å»ºé—®é¢˜è¯Šæ–­
```powershell
# æ¸…ç†å¹¶é‡æ–°æ„å»º
./build.ps1 Clean Build

# æ£€æŸ¥æ„å»ºè¾“å‡º
./build.ps1 Build --verbosity detailed

# éªŒè¯ç‰ˆæœ¬æ³¨å…¥
dotnet build --verbosity normal | findstr Version
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å‘å¸ƒå‰æ£€æŸ¥æ¸…å•
- [ ] `UpgradeVersion --lock` å·²æ‰§è¡Œå¹¶æäº¤
- [ ] CI å…¨ç»¿ï¼ˆæµ‹è¯•/è´¨é‡/å®‰å…¨ï¼‰
- [ ] `release` åˆ†æ”¯ä¸ºæœ€æ–°ä¸”æ— æœªæäº¤
- [ ] å·®å¼‚å®¡é˜…æ¸…æ™°ï¼ˆä¸Šä¸€ä¸ªæ ‡ç­¾..HEADï¼‰
- [ ] æ— ä¸´æ—¶/è°ƒè¯•æ–‡ä»¶

### 2. åˆ†æ”¯ç®¡ç†ç­–ç•¥
- ä¿æŒ main åˆ†æ”¯çš„ç¨³å®šæ€§
- åŠŸèƒ½å¼€å‘ä½¿ç”¨ `feature/` å‰ç¼€åˆ†æ”¯
- ç´§æ€¥ä¿®å¤ä½¿ç”¨ `hotfix/` å‰ç¼€åˆ†æ”¯
- åŠæ—¶æ¸…ç†å·²åˆå¹¶çš„åˆ†æ”¯

### 3. æ ‡ç­¾ç®¡ç†è§„èŒƒ
- æ ‡ç­¾ = ç‰ˆæœ¬å·çš„å”¯ä¸€ç»‘å®š
- åˆ é™¤æ ‡ç­¾ä»…åœ¨äº§ç‰©é”™è¯¯ä¸”éœ€é‡æ–°å‘å¸ƒæ—¶æ‰§è¡Œ
- ä½¿ç”¨æ³¨é‡Šæ ‡ç­¾è®°å½•ä¸Šä¸‹æ–‡

### 4. æäº¤æ¶ˆæ¯è§„èŒƒ
- ä½¿ç”¨å‰ç¼€ï¼ˆfeat|fix|refactor|perf|docs|build|chore|ci|testï¼‰
- ç ´åæ€§å˜æ›´åœ¨æ­£æ–‡è¯´æ˜è¿ç§»ç­–ç•¥
- ç®€æ´ä¸”å¯è¯»

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å‘å¸ƒå·¥ä½œæµæŒ‡å—](./release-workflow.md)
- [æµ‹è¯•æ¶æ„æ–‡æ¡£](./testing-architecture.md)
- [æ„å»ºç³»ç»Ÿè¯´æ˜](./build-system.md)
- [é¡¹ç›®çŠ¶æ€æŠ¥å‘Š](./project-status.md)

---

---
æœ€åæ›´æ–°ï¼š2025-09-22 Â· æ–‡æ¡£ç‰ˆæœ¬ï¼š2.0ï¼ˆè¿ç§»è‡³é”å®šæ—¶é—´åºåˆ—ç‰ˆæœ¬ä½“ç³»ï¼‰